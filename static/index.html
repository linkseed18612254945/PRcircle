<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PRcircle – Multi-Agent Analysis</title>
    <style>
      /* ============================================================
         PRcircle – Claude Code Inspired Dark Theme
         ============================================================ */
      :root {
        --bg-primary: #0d0d12;
        --bg-secondary: #141420;
        --bg-surface: #1a1a2c;
        --bg-elevated: #22223a;
        --bg-hover: #282848;
        --bg-input: #16162a;

        --text-primary: #e8e8f2;
        --text-secondary: #9898b4;
        --text-muted: #5e5e7a;
        --text-inverse: #0d0d12;

        --border: rgba(255,255,255,0.07);
        --border-strong: rgba(255,255,255,0.13);
        --border-focus: rgba(139,124,247,0.5);

        --accent: #8b7cf7;
        --accent-hover: #9d90ff;
        --accent-muted: rgba(139,124,247,0.12);
        --accent-glow: rgba(139,124,247,0.3);

        --agent-a: #8b7cf7; --agent-a-bg: rgba(139,124,247,0.07); --agent-a-border: rgba(139,124,247,0.2);
        --agent-b: #ff6b8a; --agent-b-bg: rgba(255,107,138,0.07); --agent-b-border: rgba(255,107,138,0.2);
        --agent-c: #4ecdc4; --agent-c-bg: rgba(78,205,196,0.07);  --agent-c-border: rgba(78,205,196,0.2);

        --success: #4ade80;
        --success-muted: rgba(74,222,128,0.12);
        --warning: #fbbf24;
        --warning-muted: rgba(251,191,36,0.12);
        --error: #f87171;
        --error-muted: rgba(248,113,113,0.12);

        --radius-xs: 4px;
        --radius-sm: 6px;
        --radius-md: 10px;
        --radius-lg: 14px;
        --radius-xl: 20px;

        --shadow: 0 4px 24px rgba(0,0,0,0.4);
        --shadow-lg: 0 12px 48px rgba(0,0,0,0.5);

        --ease: cubic-bezier(0.4, 0, 0.2, 1);
        --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);

        --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Inter, 'Noto Sans SC', sans-serif;
        --font-mono: 'SF Mono', 'Fira Code', 'JetBrains Mono', Consolas, monospace;
      }

      /* ── Reset ── */
      *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
      html { scroll-behavior: smooth; }
      body {
        font-family: var(--font-sans);
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      /* ── Scrollbar ── */
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 3px; }
      ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.14); }

      /* ── Header ── */
      .header {
        height: 52px;
        background: rgba(13,13,18,0.85);
        backdrop-filter: blur(16px) saturate(1.8);
        -webkit-backdrop-filter: blur(16px) saturate(1.8);
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        position: relative;
        z-index: 100;
        flex-shrink: 0;
      }
      .header-left { display: flex; align-items: center; gap: 12px; }
      .logo-mark {
        width: 32px; height: 32px;
        background: linear-gradient(135deg, var(--accent), #b794f6);
        border-radius: 8px;
        display: flex; align-items: center; justify-content: center;
        font-size: 11px; font-weight: 800; color: #fff;
        letter-spacing: -0.5px;
        box-shadow: 0 2px 12px var(--accent-glow);
      }
      .logo-text {
        font-size: 16px; font-weight: 700; color: var(--text-primary);
        letter-spacing: -0.3px;
      }
      .logo-text span { color: var(--text-muted); font-weight: 400; font-size: 12px; margin-left: 8px; }
      .header-right { display: flex; align-items: center; gap: 6px; }
      .header-btn {
        width: 34px; height: 34px;
        background: transparent; border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        color: var(--text-secondary);
        cursor: pointer;
        display: flex; align-items: center; justify-content: center;
        transition: all 0.2s var(--ease);
        font-size: 16px;
      }
      .header-btn:hover {
        background: var(--bg-elevated);
        border-color: var(--border-strong);
        color: var(--text-primary);
      }
      .header-btn.active {
        background: var(--accent-muted);
        border-color: var(--accent);
        color: var(--accent);
      }

      /* ── Main Layout ── */
      .main-wrap {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        max-width: 960px;
        width: 100%;
        margin: 0 auto;
      }

      /* ── Topic Panel ── */
      .topic-panel {
        padding: 16px 20px;
        border-bottom: 1px solid var(--border);
        background: var(--bg-secondary);
        transition: all 0.3s var(--ease);
        overflow: hidden;
        flex-shrink: 0;
      }
      .topic-panel.collapsed {
        max-height: 0;
        padding-top: 0;
        padding-bottom: 0;
        border-bottom-color: transparent;
      }
      .topic-row {
        display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;
      }
      .topic-field { flex: 1; min-width: 160px; }
      .topic-label {
        display: block;
        font-size: 10px; font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.8px;
        margin-bottom: 5px;
      }
      .topic-input {
        width: 100%;
        padding: 8px 12px;
        background: var(--bg-input);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        color: var(--text-primary);
        font-size: 13px;
        font-family: var(--font-sans);
        transition: all 0.2s var(--ease);
        outline: none;
      }
      .topic-input:focus {
        border-color: var(--border-focus);
        box-shadow: 0 0 0 2px var(--accent-muted);
      }
      .topic-input:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }
      .topic-input::placeholder { color: var(--text-muted); }
      textarea.topic-input { resize: vertical; min-height: 60px; }

      .topic-actions {
        display: flex; align-items: center; gap: 10px; flex-wrap: wrap;
      }

      /* Session select */
      .session-select {
        padding: 7px 28px 7px 10px;
        background: var(--bg-input);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        color: var(--text-secondary);
        font-size: 12px;
        font-family: var(--font-sans);
        cursor: pointer;
        transition: all 0.2s var(--ease);
        outline: none;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%235e5e7a' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 10px center;
      }
      .session-select:focus { border-color: var(--border-focus); }
      .session-select:disabled { opacity: 0.4; cursor: not-allowed; }

      /* ── Buttons ── */
      .btn {
        display: inline-flex; align-items: center; justify-content: center; gap: 6px;
        padding: 8px 16px;
        border: none; border-radius: var(--radius-sm);
        font-size: 12px; font-weight: 600;
        font-family: var(--font-sans);
        cursor: pointer;
        transition: all 0.2s var(--ease);
        white-space: nowrap;
        outline: none;
      }
      .btn:active { transform: scale(0.97); }
      .btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; }

      .btn-primary {
        background: linear-gradient(135deg, var(--accent), #a78bfa);
        color: #fff;
        box-shadow: 0 2px 12px var(--accent-glow);
      }
      .btn-primary:hover:not(:disabled) { box-shadow: 0 4px 20px var(--accent-glow); transform: translateY(-1px); }

      .btn-ghost {
        background: transparent;
        color: var(--text-secondary);
        border: 1px solid var(--border);
      }
      .btn-ghost:hover:not(:disabled) { background: var(--bg-elevated); border-color: var(--border-strong); color: var(--text-primary); }

      .btn-danger {
        background: var(--error-muted);
        color: var(--error);
        border: 1px solid rgba(248,113,113,0.2);
      }
      .btn-danger:hover:not(:disabled) { background: rgba(248,113,113,0.2); }

      .btn-sm { padding: 5px 10px; font-size: 11px; }

      /* ── Status Bar ── */
      .status-bar {
        display: flex; align-items: center; gap: 8px;
        margin-top: 10px;
        font-size: 11px; color: var(--text-muted);
      }
      .status-dot {
        width: 6px; height: 6px; border-radius: 50%;
        background: var(--text-muted); flex-shrink: 0;
        transition: background 0.3s;
      }
      .status-dot.running { background: var(--accent); animation: pulse 1.5s ease-in-out infinite; }
      .status-dot.done { background: var(--success); }
      .status-dot.error { background: var(--error); }
      @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.3; } }

      /* ── Progress ── */
      .progress-wrap {
        display: none;
        padding: 0 20px;
        flex-shrink: 0;
      }
      .progress-wrap.active { display: block; }
      .progress-track {
        width: 100%;
        height: 2px;
        background: var(--border);
        border-radius: 1px;
        overflow: hidden;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--accent), #a78bfa, var(--accent));
        background-size: 200% 100%;
        border-radius: 1px;
        transition: width 0.6s var(--ease);
        width: 0%;
        animation: shimmer 2s linear infinite;
      }
      @keyframes shimmer { to { background-position: -200% 0; } }
      .progress-meta {
        display: flex; justify-content: space-between;
        padding: 4px 0 8px;
        font-size: 10px; color: var(--text-muted);
      }

      /* ── Agent Activity Panel ── */
      .agent-panel {
        display: none;
        padding: 10px 20px;
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border);
        flex-shrink: 0;
      }
      .agent-panel.active { display: flex; align-items: center; gap: 10px; animation: slideDown 0.25s var(--ease); }
      @keyframes slideDown { from { opacity: 0; transform: translateY(-8px); } to { opacity: 1; transform: translateY(0); } }

      .agent-panel-dot {
        width: 28px; height: 28px;
        border-radius: 7px;
        display: flex; align-items: center; justify-content: center;
        font-weight: 800; font-size: 12px; color: #fff; flex-shrink: 0;
      }
      .agent-panel-info { flex: 1; }
      .agent-panel-name { font-size: 12px; font-weight: 700; }
      .agent-panel-phase {
        font-size: 11px; color: var(--text-muted);
        display: flex; align-items: center; gap: 6px; margin-top: 1px;
      }
      .spinner {
        width: 10px; height: 10px;
        border: 1.5px solid var(--border-strong);
        border-top-color: var(--accent);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }
      @keyframes spin { to { transform: rotate(360deg); } }

      /* ── Messages Area ── */
      .messages-area {
        flex: 1;
        overflow-y: auto;
        scroll-behavior: smooth;
        padding: 0;
      }

      /* Empty State */
      .empty-state {
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        padding: 80px 20px;
        text-align: center;
        min-height: 400px;
      }
      .empty-logo {
        width: 56px; height: 56px;
        background: linear-gradient(135deg, var(--accent), #b794f6);
        border-radius: 16px;
        display: flex; align-items: center; justify-content: center;
        font-size: 18px; font-weight: 800; color: #fff;
        box-shadow: 0 4px 24px var(--accent-glow);
        margin-bottom: 20px;
      }
      .empty-title {
        font-size: 16px; font-weight: 600; color: var(--text-primary);
        margin-bottom: 8px;
      }
      .empty-desc {
        font-size: 13px; color: var(--text-muted); line-height: 1.7;
        max-width: 360px;
      }
      .empty-agents {
        margin-top: 24px;
        display: flex; flex-direction: column; gap: 8px;
      }
      .empty-agent {
        display: flex; align-items: center; gap: 10px;
        font-size: 12px; color: var(--text-secondary);
      }
      .empty-agent-dot {
        width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
      }

      /* ── Round Divider ── */
      .round-divider {
        display: flex; align-items: center; gap: 12px;
        padding: 16px 20px 8px;
      }
      .round-line { flex: 1; height: 1px; background: var(--border); }
      .round-badge {
        display: inline-flex; align-items: center; gap: 6px;
        padding: 3px 12px;
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: 12px;
        font-size: 10px; font-weight: 700;
        color: var(--text-muted);
        letter-spacing: 0.5px;
        text-transform: uppercase;
        white-space: nowrap;
      }
      .round-dot {
        width: 5px; height: 5px; border-radius: 50%;
        background: var(--accent);
      }
      .round-badge.synthesis { border-color: var(--agent-c-border); }
      .round-badge.synthesis .round-dot { background: var(--agent-c); }

      /* ── Message ── */
      .msg {
        padding: 16px 20px;
        border-left: 3px solid transparent;
        position: relative;
        animation: msgIn 0.35s var(--ease);
        transition: background 0.15s;
      }
      .msg:not(:last-child) { border-bottom: 1px solid var(--border); }
      .msg:hover { background: rgba(255,255,255,0.015); }
      @keyframes msgIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

      .msg.A { border-left-color: var(--agent-a); background: var(--agent-a-bg); }
      .msg.A:hover { background: rgba(139,124,247,0.1); }
      .msg.B { border-left-color: var(--agent-b); background: var(--agent-b-bg); }
      .msg.B:hover { background: rgba(255,107,138,0.1); }
      .msg.C { border-left-color: var(--agent-c); background: var(--agent-c-bg); }
      .msg.C:hover { background: rgba(78,205,196,0.1); }
      .msg.user { border-left-color: var(--text-muted); background: rgba(255,255,255,0.02); }

      .msg-header {
        display: flex; align-items: center; gap: 10px; margin-bottom: 10px;
      }
      .msg-avatar {
        width: 26px; height: 26px;
        border-radius: 6px;
        display: flex; align-items: center; justify-content: center;
        font-size: 11px; font-weight: 800; color: #fff; flex-shrink: 0;
      }
      .msg.A .msg-avatar { background: var(--agent-a); }
      .msg.B .msg-avatar { background: var(--agent-b); }
      .msg.C .msg-avatar { background: var(--agent-c); }
      .msg.user .msg-avatar { background: var(--text-muted); }

      .msg-info { flex: 1; min-width: 0; }
      .msg-role { font-size: 12px; font-weight: 700; }
      .msg.A .msg-role { color: var(--agent-a); }
      .msg.B .msg-role { color: var(--agent-b); }
      .msg.C .msg-role { color: var(--agent-c); }
      .msg.user .msg-role { color: var(--text-muted); }
      .msg-subtitle { font-size: 10px; color: var(--text-muted); margin-top: 1px; }
      .msg-time { font-size: 10px; color: var(--text-muted); flex-shrink: 0; }

      /* ── Markdown Body ── */
      .markdown-body {
        font-size: 13px; color: var(--text-primary); line-height: 1.75;
      }
      .markdown-body h2 { font-size: 16px; font-weight: 700; margin: 14px 0 6px; padding-bottom: 4px; border-bottom: 1px solid var(--border); }
      .markdown-body h3 { font-size: 14px; font-weight: 700; margin: 10px 0 4px; }
      .markdown-body h4 { font-size: 13px; font-weight: 700; margin: 8px 0 3px; }
      .markdown-body h5 { font-size: 12px; font-weight: 600; margin: 6px 0 2px; color: var(--text-secondary); }
      .markdown-body p { margin: 5px 0; }
      .markdown-body ul, .markdown-body ol { margin: 5px 0 5px 18px; }
      .markdown-body li { margin: 2px 0; }
      .markdown-body code {
        background: rgba(255,255,255,0.07);
        padding: 1px 6px;
        border-radius: 4px;
        font-family: var(--font-mono);
        font-size: 11.5px;
      }
      .markdown-body pre {
        background: var(--bg-primary);
        border: 1px solid var(--border);
        padding: 14px;
        border-radius: var(--radius-md);
        overflow-x: auto;
        margin: 8px 0;
        font-size: 12px;
        line-height: 1.5;
      }
      .markdown-body pre code { background: none; padding: 0; font-size: inherit; }
      .markdown-body a { color: var(--accent); text-decoration: none; font-weight: 500; }
      .markdown-body a:hover { text-decoration: underline; }
      .markdown-body blockquote {
        border-left: 2px solid var(--border-strong);
        padding-left: 12px;
        color: var(--text-secondary);
        margin: 6px 0;
        font-style: italic;
      }

      /* ── Tool Blocks (Collapsible, Claude Code style) ── */
      .tool-blocks { margin-top: 12px; display: flex; flex-direction: column; gap: 6px; }

      .tool-block {
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        background: var(--bg-secondary);
        overflow: hidden;
        transition: border-color 0.2s;
      }
      .tool-block:hover { border-color: var(--border-strong); }

      .tool-block-header {
        display: flex; align-items: center; gap: 8px;
        padding: 8px 12px;
        cursor: pointer;
        user-select: none;
        font-size: 12px;
        color: var(--text-secondary);
        transition: background 0.15s;
      }
      .tool-block-header:hover { background: rgba(255,255,255,0.03); }

      .tool-block-icon {
        width: 20px; height: 20px;
        border-radius: 5px;
        display: flex; align-items: center; justify-content: center;
        font-size: 10px; flex-shrink: 0;
      }
      .tool-block-icon.search { background: var(--accent-muted); color: var(--accent); }
      .tool-block-icon.source { background: var(--success-muted); color: var(--success); }
      .tool-block-icon.cite { background: var(--warning-muted); color: var(--warning); }
      .tool-block-icon.json { background: rgba(255,255,255,0.06); color: var(--text-muted); }

      .tool-block-label { flex: 1; font-weight: 600; }
      .tool-block-count {
        padding: 1px 6px;
        background: rgba(255,255,255,0.06);
        border-radius: 4px;
        font-size: 10px; font-weight: 600;
        color: var(--text-muted);
      }
      .tool-block-chevron {
        width: 16px; height: 16px;
        transition: transform 0.2s var(--ease);
        color: var(--text-muted);
      }
      .tool-block.open .tool-block-chevron { transform: rotate(90deg); }

      .tool-block-body {
        display: none;
        padding: 0 12px 10px;
        animation: fadeExpand 0.2s var(--ease);
      }
      .tool-block.open .tool-block-body { display: block; }
      @keyframes fadeExpand { from { opacity: 0; } to { opacity: 1; } }

      /* Search pills */
      .search-pills { display: flex; flex-wrap: wrap; gap: 5px; }
      .search-pill {
        display: inline-flex; align-items: center; gap: 4px;
        padding: 4px 10px;
        background: rgba(255,255,255,0.04);
        border: 1px solid var(--border);
        border-radius: 14px;
        font-size: 11px; color: var(--text-secondary);
        max-width: 100%;
      }
      .search-pill-dot {
        width: 4px; height: 4px; border-radius: 50%;
        background: var(--accent); flex-shrink: 0;
      }
      .search-pill-text { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

      /* Retrieval cards */
      .retrieval-list { display: flex; flex-direction: column; gap: 4px; }
      .retrieval-item {
        display: flex; gap: 8px; align-items: flex-start;
        padding: 8px 10px;
        background: rgba(255,255,255,0.02);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        transition: background 0.15s;
      }
      .retrieval-item:hover { background: rgba(255,255,255,0.04); }
      .retrieval-idx {
        width: 20px; height: 20px;
        border-radius: 5px;
        background: var(--accent);
        color: #fff;
        display: flex; align-items: center; justify-content: center;
        font-size: 9px; font-weight: 700; flex-shrink: 0;
        margin-top: 1px;
      }
      .retrieval-idx.cite { background: var(--warning); }
      .retrieval-body { flex: 1; min-width: 0; }
      .retrieval-title {
        font-size: 12px; font-weight: 600; color: var(--text-primary);
        overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
      }
      .retrieval-title a { color: var(--accent); text-decoration: none; }
      .retrieval-title a:hover { text-decoration: underline; }
      .retrieval-url {
        font-size: 10px; color: var(--text-muted);
        overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
        margin-top: 1px;
      }
      .retrieval-snippet {
        font-size: 11px; color: var(--text-secondary); line-height: 1.5;
        margin-top: 3px;
        display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
      }
      .retrieval-score {
        flex-shrink: 0; align-self: flex-start;
        padding: 1px 5px;
        background: var(--success-muted);
        border-radius: 3px;
        font-size: 9px; font-weight: 700;
        color: var(--success);
      }

      /* JSON block */
      .json-pre {
        background: var(--bg-primary);
        border: 1px solid var(--border);
        padding: 10px;
        border-radius: var(--radius-sm);
        font-size: 11px; font-family: var(--font-mono);
        line-height: 1.5;
        overflow-x: auto;
        max-height: 300px;
        overflow-y: auto;
        color: var(--text-secondary);
      }

      /* ── Streaming card ── */
      .msg-streaming { animation: msgIn 0.3s var(--ease); }

      .stream-text {
        white-space: pre-wrap;
        word-break: break-word;
        font-size: 13px;
        color: var(--text-primary);
        line-height: 1.75;
        min-height: 1.2em;
      }

      .stream-cursor {
        display: inline-block;
        width: 2px; height: 1em;
        background: var(--accent);
        margin-left: 2px;
        vertical-align: text-bottom;
        border-radius: 1px;
        animation: blink 1s step-end infinite;
      }
      @keyframes blink { 0%,100% { opacity: 1; } 50% { opacity: 0; } }

      .stream-badge {
        display: inline-flex; align-items: center; gap: 5px;
        font-size: 10px; color: var(--accent); font-weight: 600;
      }
      .stream-badge::before {
        content: '';
        width: 5px; height: 5px;
        border-radius: 50%;
        background: var(--accent);
        animation: pulse 1.2s ease-in-out infinite;
      }

      /* ── Settings Drawer ── */
      .drawer-overlay {
        position: fixed; inset: 0;
        background: rgba(0,0,0,0.5);
        backdrop-filter: blur(4px);
        z-index: 200;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s var(--ease);
      }
      .drawer-overlay.open { opacity: 1; pointer-events: auto; }

      .settings-drawer {
        position: fixed; top: 0; right: 0; bottom: 0;
        width: 420px; max-width: 90vw;
        background: var(--bg-secondary);
        border-left: 1px solid var(--border);
        z-index: 201;
        transform: translateX(100%);
        transition: transform 0.3s var(--ease);
        overflow-y: auto;
        display: flex; flex-direction: column;
      }
      .settings-drawer.open { transform: translateX(0); }

      .drawer-header {
        display: flex; align-items: center; justify-content: space-between;
        padding: 16px 20px;
        border-bottom: 1px solid var(--border);
        flex-shrink: 0;
      }
      .drawer-title { font-size: 15px; font-weight: 700; }
      .drawer-close {
        width: 28px; height: 28px;
        background: transparent; border: 1px solid var(--border);
        border-radius: var(--radius-xs);
        color: var(--text-muted);
        cursor: pointer;
        display: flex; align-items: center; justify-content: center;
        font-size: 14px;
        transition: all 0.2s;
      }
      .drawer-close:hover { background: var(--bg-elevated); color: var(--text-primary); }

      .drawer-body { padding: 16px 20px; flex: 1; }

      .settings-section {
        margin-bottom: 20px;
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        overflow: hidden;
      }
      .settings-section-header {
        display: flex; align-items: center; gap: 10px;
        padding: 12px 16px;
        background: var(--bg-elevated);
        border-bottom: 1px solid var(--border);
      }
      .settings-badge {
        width: 26px; height: 26px;
        border-radius: 6px;
        display: flex; align-items: center; justify-content: center;
        font-size: 11px; font-weight: 800; color: #fff;
      }
      .settings-section-info { flex: 1; }
      .settings-section-title { font-size: 13px; font-weight: 700; }
      .settings-section-desc { font-size: 10px; color: var(--text-muted); margin-top: 1px; }

      .settings-section-body { padding: 12px 16px; }

      .setting-group { margin-bottom: 10px; }
      .setting-group:last-child { margin-bottom: 0; }
      .setting-label {
        display: block;
        font-size: 10px; font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.6px;
        margin-bottom: 4px;
      }
      .setting-input {
        width: 100%;
        padding: 7px 10px;
        background: var(--bg-input);
        border: 1px solid var(--border);
        border-radius: var(--radius-xs);
        color: var(--text-primary);
        font-size: 12px;
        font-family: var(--font-sans);
        transition: all 0.2s var(--ease);
        outline: none;
      }
      .setting-input:focus { border-color: var(--border-focus); box-shadow: 0 0 0 2px var(--accent-muted); }
      textarea.setting-input { resize: vertical; min-height: 50px; font-family: var(--font-sans); }

      .setting-row { display: flex; gap: 8px; }
      .setting-row .setting-group { flex: 1; }

      /* Agent section colors */
      .settings-section.agent-a .settings-badge { background: var(--agent-a); }
      .settings-section.agent-a .settings-section-title { color: var(--agent-a); }
      .settings-section.agent-b .settings-badge { background: var(--agent-b); }
      .settings-section.agent-b .settings-section-title { color: var(--agent-b); }
      .settings-section.agent-c .settings-badge { background: var(--agent-c); }
      .settings-section.agent-c .settings-section-title { color: var(--agent-c); }
      .settings-section.tavily .settings-badge { background: var(--warning); }
      .settings-section.tavily .settings-section-title { color: var(--warning); }

      /* ── Responsive ── */
      @media (max-width: 768px) {
        .topic-row { flex-direction: column; }
        .topic-field { min-width: 100%; }
        .topic-actions { flex-direction: column; }
        .session-select { width: 100%; }
        .btn-primary { width: 100%; }
        .msg { padding: 12px 16px; }
        .round-divider { padding: 12px 16px 6px; }
        .settings-drawer { width: 100%; max-width: 100%; }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="logo-mark">PR</div>
        <div class="logo-text">PRcircle <span>Multi-Agent Analysis</span></div>
      </div>
      <div class="header-right">
        <button id="topicToggle" class="header-btn" title="Toggle topic panel">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M2 4h12M2 8h8M2 12h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        </button>
        <button id="settingsToggle" class="header-btn" title="Settings">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="2" stroke="currentColor" stroke-width="1.4"/><path d="M8 1v2M8 13v2M1 8h2M13 8h2M3.05 3.05l1.41 1.41M11.54 11.54l1.41 1.41M3.05 12.95l1.41-1.41M11.54 4.46l1.41-1.41" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg>
        </button>
      </div>
    </header>

    <div class="main-wrap">
      <!-- Topic Panel -->
      <div id="topicPanel" class="topic-panel">
        <div class="topic-row">
          <div class="topic-field" style="flex:2">
            <label class="topic-label" for="topic">Event Topic</label>
            <input id="topic" class="topic-input" placeholder="Enter the political event topic..." />
          </div>
          <div class="topic-field" style="flex:1">
            <label class="topic-label" for="timeContext">Time Context</label>
            <input id="timeContext" class="topic-input" placeholder="e.g. 72h after..." />
          </div>
        </div>
        <div class="topic-row">
          <div class="topic-field" style="flex:3">
            <label class="topic-label" for="prGoal">PR Goal</label>
            <input id="prGoal" class="topic-input" placeholder="e.g. stabilize sentiment, rebuild trust..." />
          </div>
          <div class="topic-field" style="flex:0 0 80px">
            <label class="topic-label" for="maxRounds">Rounds</label>
            <input id="maxRounds" class="topic-input" type="number" value="3" min="1" max="8" />
          </div>
        </div>
        <div class="topic-actions">
          <button id="startBtn" class="btn btn-primary" type="button">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><polygon points="4,2 14,8 4,14"/></svg>
            Start Analysis
          </button>
          <button id="stopBtn" class="btn btn-danger btn-sm" type="button" style="display:none">Stop</button>
          <select id="sessionSelect" class="session-select"></select>
          <button id="newSessionBtn" class="btn btn-ghost btn-sm" type="button">+ New</button>
          <button id="clearSessionBtn" class="btn btn-ghost btn-sm" type="button">Clear</button>
        </div>
        <div class="status-bar">
          <span id="statusDot" class="status-dot"></span>
          <span id="runStatus">Ready</span>
          <span style="margin-left:auto" id="msgCount"></span>
        </div>
      </div>

      <!-- Progress -->
      <div id="progressWrap" class="progress-wrap">
        <div class="progress-track"><div id="progressFill" class="progress-fill"></div></div>
        <div class="progress-meta">
          <span id="progressLabel">Round 0 / 0</span>
          <span id="progressPct">0%</span>
        </div>
      </div>

      <!-- Agent Activity Panel -->
      <div id="agentPanel" class="agent-panel">
        <div id="agentPanelAvatar" class="agent-panel-dot">A</div>
        <div class="agent-panel-info">
          <div id="agentPanelName" class="agent-panel-name">Agent A</div>
          <div class="agent-panel-phase">
            <div class="spinner" id="agentSpinner"></div>
            <span id="agentPanelPhase">Searching &amp; analyzing...</span>
          </div>
        </div>
      </div>

      <!-- Messages (incremental) -->
      <div id="messages" class="messages-area">
        <div class="empty-state" id="emptyState">
          <div class="empty-logo">PR</div>
          <div class="empty-title">Multi-Agent PR Strategy Analysis</div>
          <div class="empty-desc">
            Configure your topic above and start a multi-perspective analysis session.
          </div>
          <div class="empty-agents">
            <div class="empty-agent">
              <div class="empty-agent-dot" style="background:var(--agent-a)"></div>
              Agent A &mdash; Analyst &middot; Proposes structured solutions with evidence
            </div>
            <div class="empty-agent">
              <div class="empty-agent-dot" style="background:var(--agent-b)"></div>
              Agent B &mdash; Challenger &middot; Critiques proposals with counter-evidence
            </div>
            <div class="empty-agent">
              <div class="empty-agent-dot" style="background:var(--agent-c)"></div>
              Agent C &mdash; Observer &middot; Synthesizes final strategy report
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Drawer Overlay -->
    <div id="settingsOverlay" class="drawer-overlay"></div>

    <!-- Settings Drawer -->
    <div id="settingsDrawer" class="settings-drawer">
      <div class="drawer-header">
        <div class="drawer-title">Settings</div>
        <button id="settingsClose" class="drawer-close" title="Close">&times;</button>
      </div>
      <div class="drawer-body">
        <!-- Agent A -->
        <div class="settings-section agent-a">
          <div class="settings-section-header">
            <div class="settings-badge">A</div>
            <div class="settings-section-info">
              <div class="settings-section-title">Agent A &middot; Analyst</div>
              <div class="settings-section-desc">Proposes structured solutions with evidence</div>
            </div>
          </div>
          <div class="settings-section-body">
            <div class="setting-group"><label class="setting-label">Model</label><input id="a_model" class="setting-input" value="gpt-4o-mini" /></div>
            <div class="setting-group"><label class="setting-label">API Endpoint</label><input id="a_base" class="setting-input" value="https://api.openai.com/v1" /></div>
            <div class="setting-group"><label class="setting-label">API Key</label><input id="a_key" class="setting-input" type="password" placeholder="Enter API key..." /></div>
            <div class="setting-row">
              <div class="setting-group"><label class="setting-label">Temperature</label><input id="a_temp" class="setting-input" value="0.7" type="number" step="0.1" min="0" max="2" /></div>
              <div class="setting-group"><label class="setting-label">Max Tokens</label><input id="a_max" class="setting-input" value="800" type="number" /></div>
            </div>
            <div class="setting-group"><label class="setting-label">Capability Prompt</label><textarea id="a_capability" class="setting-input">偏向给出可执行步骤、风险与验证方案。</textarea></div>
          </div>
        </div>

        <!-- Agent B -->
        <div class="settings-section agent-b">
          <div class="settings-section-header">
            <div class="settings-badge">B</div>
            <div class="settings-section-info">
              <div class="settings-section-title">Agent B &middot; Challenger</div>
              <div class="settings-section-desc">Critiques proposals with counter-evidence</div>
            </div>
          </div>
          <div class="settings-section-body">
            <div class="setting-group"><label class="setting-label">Model</label><input id="b_model" class="setting-input" value="gpt-4o-mini" /></div>
            <div class="setting-group"><label class="setting-label">API Endpoint</label><input id="b_base" class="setting-input" value="https://api.openai.com/v1" /></div>
            <div class="setting-group"><label class="setting-label">API Key</label><input id="b_key" class="setting-input" type="password" placeholder="Enter API key..." /></div>
            <div class="setting-row">
              <div class="setting-group"><label class="setting-label">Temperature</label><input id="b_temp" class="setting-input" value="0.7" type="number" step="0.1" min="0" max="2" /></div>
              <div class="setting-group"><label class="setting-label">Max Tokens</label><input id="b_max" class="setting-input" value="800" type="number" /></div>
            </div>
            <div class="setting-group"><label class="setting-label">Capability Prompt</label><textarea id="b_capability" class="setting-input">偏向挑战假设、提出反例与可复现实验。</textarea></div>
          </div>
        </div>

        <!-- Agent C -->
        <div class="settings-section agent-c">
          <div class="settings-section-header">
            <div class="settings-badge">C</div>
            <div class="settings-section-info">
              <div class="settings-section-title">Agent C &middot; Observer</div>
              <div class="settings-section-desc">Synthesizes final strategy report</div>
            </div>
          </div>
          <div class="settings-section-body">
            <div class="setting-group"><label class="setting-label">Model</label><input id="c_model" class="setting-input" value="gpt-4o-mini" /></div>
            <div class="setting-group"><label class="setting-label">API Endpoint</label><input id="c_base" class="setting-input" value="https://api.openai.com/v1" /></div>
            <div class="setting-group"><label class="setting-label">API Key</label><input id="c_key" class="setting-input" type="password" placeholder="Enter API key..." /></div>
            <div class="setting-row">
              <div class="setting-group"><label class="setting-label">Temperature</label><input id="c_temp" class="setting-input" value="0.7" type="number" step="0.1" min="0" max="2" /></div>
              <div class="setting-group"><label class="setting-label">Max Tokens</label><input id="c_max" class="setting-input" value="1000" type="number" /></div>
            </div>
            <div class="setting-group"><label class="setting-label">Capability Prompt</label><textarea id="c_capability" class="setting-input">偏向形成可执行的最终策略报告，明确优先级、风险预案和监测指标。</textarea></div>
          </div>
        </div>

        <!-- Tavily -->
        <div class="settings-section tavily">
          <div class="settings-section-header">
            <div class="settings-badge">T</div>
            <div class="settings-section-info">
              <div class="settings-section-title">Tavily Search</div>
              <div class="settings-section-desc">External retrieval configuration</div>
            </div>
          </div>
          <div class="settings-section-body">
            <div class="setting-group"><label class="setting-label">API Key</label><input id="tavilyKey" class="setting-input" type="password" placeholder="Enter Tavily API key..." /></div>
            <div class="setting-row">
              <div class="setting-group"><label class="setting-label">Search Top-K</label><input id="searchTopk" class="setting-input" type="number" value="5" min="1" max="20" /></div>
              <div class="setting-group"><label class="setting-label">Domain Filters</label><input id="searchDomains" class="setting-input" placeholder="Comma-separated" /></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="/static/main.js"></script>
  </body>
</html>
