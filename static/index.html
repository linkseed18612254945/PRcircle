<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PRcircle — Intelligence Analysis</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=JetBrains+Mono:wght@300;400;500&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&family=Noto+Sans+SC:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    /* ── Design System ── */
    :root {
      --bg:     #05070e;
      --bg2:    #080c17;
      --surf:   #0d1526;
      --surf2:  #142035;
      --over:   #1c2d45;
      --bdr:    #182840;
      --bdr2:   #223555;
      --bdr3:   #2e4570;
      --text:   #bfcfde;
      --sub:    #5a7a96;
      --mute:   #2c4060;
      /* Accent: ops-room amber */
      --acc:    #d99a18;
      --acc2:   #f0b830;
      --acc-d:  rgba(217,154,24,.08);
      --acc-g:  rgba(217,154,24,.22);
      /* Agent palettes */
      --a:      #4888f4;  --a-d: rgba(72,136,244,.08);  --a-g: rgba(72,136,244,.22);  --a-b: rgba(72,136,244,.28);
      --b:      #f04468;  --b-d: rgba(240,68,104,.08);  --b-g: rgba(240,68,104,.22);  --b-b: rgba(240,68,104,.28);
      --c:      #00d87a;  --c-d: rgba(0,216,122,.08);   --c-g: rgba(0,216,122,.22);   --c-b: rgba(0,216,122,.28);
      --u:      #4a6a8c;  --u-d: rgba(74,106,140,.08);
      /* Legacy aliases (main.js references) */
      --a-color: var(--a); --b-color: var(--b); --c-color: var(--c);
      --pri: var(--acc); --pri-glow: var(--acc-g);
      /* Util */
      --danger:  #e83850;
      --success: #00cc70;
      --r: 3px;  --t: .14s ease;
      --hdr: 50px;  --side: 336px;
      --font-d: 'Bebas Neue','Arial Black',sans-serif;
      --font-m: 'JetBrains Mono','Courier New',monospace;
      --font-b: 'DM Sans','Noto Sans SC',system-ui,sans-serif;
    }

    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{
      font-family:var(--font-b);
      background:var(--bg);
      color:var(--text);
      line-height:1.6;
      min-height:100vh;
      overflow-x:hidden;
      /* Subtle scanline texture */
      background-image:
        repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(255,255,255,.003) 3px,rgba(255,255,255,.003) 4px),
        radial-gradient(ellipse 120% 80% at 50% -20%, rgba(72,136,244,.04) 0%, transparent 60%);
    }

    /* ── HEADER ── */
    .header{
      position:fixed;top:0;left:0;right:0;
      height:var(--hdr);z-index:200;
      background:rgba(5,7,14,.95);
      border-bottom:1px solid var(--bdr2);
      backdrop-filter:blur(12px);
      display:flex;align-items:center;
      padding:0 18px;gap:0;
    }
    .header::after{
      content:'';position:absolute;bottom:-1px;left:0;right:0;height:1px;
      background:linear-gradient(90deg,transparent 0%,var(--acc) 35%,var(--a) 65%,transparent 100%);
      opacity:.35;
    }
    .logo{display:flex;align-items:center;gap:10px;flex-shrink:0;text-decoration:none}
    .logo-mark{
      width:30px;height:30px;
      background:var(--acc);
      clip-path:polygon(0 0,100% 0,100% 68%,68% 100%,0 100%);
      display:flex;align-items:center;justify-content:center;
      font-family:var(--font-d);font-size:12px;color:#000;letter-spacing:.5px;
    }
    .logo-wordmark{display:flex;flex-direction:column;gap:0}
    .logo-name{
      font-family:var(--font-d);font-size:21px;letter-spacing:3px;
      color:var(--text);line-height:1;
    }
    .logo-name em{color:var(--acc);font-style:normal}
    .logo-tagline{font-family:var(--font-m);font-size:8px;color:var(--mute);letter-spacing:2px;text-transform:uppercase;margin-top:1px}
    .hdr-rule{flex:1;height:1px;background:linear-gradient(90deg,var(--bdr2) 0%,transparent 100%);margin:0 18px}
    .hdr-stats{
      display:flex;align-items:center;gap:16px;
      font-family:var(--font-m);font-size:9px;color:var(--mute);letter-spacing:1px;
      margin-right:16px;
    }
    .hdr-stat-dot{
      width:5px;height:5px;border-radius:50%;background:var(--mute);
      display:inline-block;margin-right:5px;
    }
    .hdr-stat-dot.live{background:var(--success);box-shadow:0 0 6px rgba(0,204,112,.5);animation:pulse 2s ease-in-out infinite}
    .nav-tabs{display:flex;gap:0;border:1px solid var(--bdr2)}
    .nav-tab{
      padding:0 20px;height:32px;
      display:flex;align-items:center;
      font-family:var(--font-m);font-size:9px;letter-spacing:2.5px;text-transform:uppercase;
      color:var(--mute);cursor:pointer;background:transparent;
      border-right:1px solid var(--bdr2);transition:var(--t);user-select:none;
    }
    .nav-tab:last-child{border-right:none}
    .nav-tab:hover{color:var(--text);background:var(--surf)}
    .nav-tab.active{color:var(--acc);background:var(--acc-d);border-bottom:1px solid var(--acc)}

    /* ── SHELL ── */
    .shell{margin-top:var(--hdr);height:calc(100vh - var(--hdr))}
    .page{display:none}
    .page.active{display:flex}
    #chatPage.active{height:100%;overflow:hidden;align-items:stretch}
    #settingsPage.active{flex-direction:column;overflow-y:auto;padding:28px;height:100%}

    /* ── SIDEBAR ── */
    .sidebar{
      width:var(--side);flex-shrink:0;
      background:var(--bg2);
      border-right:1px solid var(--bdr);
      display:flex;flex-direction:column;
      overflow-y:auto;overflow-x:hidden;
    }
    .sidebar::-webkit-scrollbar{width:2px}
    .sidebar::-webkit-scrollbar-thumb{background:var(--bdr2)}

    .s-sect{padding:14px 16px;border-bottom:1px solid var(--bdr)}
    .s-label{
      font-family:var(--font-m);font-size:8px;letter-spacing:3px;text-transform:uppercase;
      color:var(--mute);margin-bottom:10px;display:flex;align-items:center;gap:6px;
    }
    .s-label::before{content:'//';color:var(--acc);font-size:9px}

    /* Agent status widgets */
    .agent-widget{
      display:flex;align-items:center;gap:10px;
      padding:8px 10px;margin-bottom:6px;
      background:var(--surf);border:1px solid var(--bdr);border-radius:var(--r);
      transition:var(--t);
    }
    .agent-widget:last-child{margin-bottom:0}
    .agent-widget.aw-a{border-left:2px solid var(--a)}
    .agent-widget.aw-b{border-left:2px solid var(--b)}
    .agent-widget.aw-c{border-left:2px solid var(--c)}
    .aw-letter{font-family:var(--font-d);font-size:18px;line-height:1;flex-shrink:0;width:20px;text-align:center}
    .aw-a .aw-letter{color:var(--a)}
    .aw-b .aw-letter{color:var(--b)}
    .aw-c .aw-letter{color:var(--c)}
    .aw-name{font-family:var(--font-d);font-size:11px;letter-spacing:2px}
    .aw-a .aw-name{color:var(--a)}.aw-b .aw-name{color:var(--b)}.aw-c .aw-name{color:var(--c)}
    .aw-desc{font-family:var(--font-m);font-size:9px;color:var(--mute);letter-spacing:.3px;margin-top:1px}

    /* ── FORM ELEMENTS ── */
    .form-group{margin-bottom:8px}
    .form-row{display:flex;gap:8px;margin-bottom:8px}
    .form-field{flex:1;min-width:0}
    .form-label{
      display:block;font-family:var(--font-m);font-size:8.5px;
      letter-spacing:1.5px;text-transform:uppercase;color:var(--sub);margin-bottom:4px;
    }
    input,textarea,select{
      width:100%;padding:7px 10px;
      background:var(--surf);border:1px solid var(--bdr2);border-radius:var(--r);
      font-family:var(--font-m);font-size:12px;color:var(--text);
      transition:var(--t);outline:none;
    }
    input:focus,textarea:focus,select:focus{
      border-color:var(--acc);background:var(--surf2);
      box-shadow:0 0 0 1px var(--acc-d),inset 0 0 0 1px var(--acc-d);
    }
    input:disabled,textarea:disabled,select:disabled{opacity:.38;cursor:not-allowed}
    textarea{resize:vertical;min-height:54px;line-height:1.5;font-size:11.5px}
    input[type="number"]{text-align:right}
    select{
      appearance:none;
      background-image:url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%232c4060' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat:no-repeat;background-position:right 9px center;padding-right:26px;
    }

    /* ── BUTTONS ── */
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:5px;
      padding:0 14px;height:32px;border:1px solid transparent;border-radius:var(--r);
      font-family:var(--font-m);font-size:9px;letter-spacing:2px;text-transform:uppercase;
      cursor:pointer;transition:var(--t);white-space:nowrap;
    }
    .btn:active{transform:scale(.96)}
    .btn-primary{background:var(--surf2);color:var(--text);border-color:var(--bdr2)}
    .btn-primary:hover{border-color:var(--bdr3);background:var(--over)}
    .btn-primary:disabled{opacity:.35;cursor:not-allowed;transform:none}
    .btn-outline{background:transparent;color:var(--sub);border-color:var(--bdr)}
    .btn-outline:hover{color:var(--text);border-color:var(--bdr2);background:var(--surf)}
    .btn-outline:disabled{opacity:.3;cursor:not-allowed;transform:none}
    .btn-danger{background:rgba(232,56,80,.08);color:var(--danger);border-color:rgba(232,56,80,.22)}
    .btn-danger:hover{background:rgba(232,56,80,.16)}
    .btn-danger:disabled{opacity:.35;cursor:not-allowed;transform:none}
    .btn-sm{height:26px;padding:0 9px;font-size:8px;letter-spacing:1.5px}
    .btn-start{
      height:38px;width:100%;padding:0 16px;
      background:var(--acc);color:#000;border-color:var(--acc2);
      font-family:var(--font-d);font-size:17px;letter-spacing:3px;font-weight:400;
      position:relative;overflow:hidden;
    }
    .btn-start::before{
      content:'';position:absolute;inset:0;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.18),transparent);
      transform:translateX(-100%);transition:transform .55s ease;
    }
    .btn-start:hover::before{transform:translateX(100%)}
    .btn-start:hover{background:var(--acc2);box-shadow:0 0 24px var(--acc-g)}
    .btn-start:disabled{background:var(--surf2);color:var(--mute);border-color:var(--bdr);box-shadow:none}
    .btn-start:disabled::before{display:none}

    /* ── SESSION BAR ── */
    .session-bar{display:flex;gap:6px;align-items:center}
    .session-select{flex:1;font-size:11.5px}

    /* ── STATUS ── */
    .status-bar{
      display:flex;align-items:center;gap:7px;padding:8px 0 2px;
      font-family:var(--font-m);font-size:10px;color:var(--sub);letter-spacing:.8px;
    }
    .status-dot{width:6px;height:6px;border-radius:50%;background:var(--mute);flex-shrink:0}
    .status-dot.running{background:var(--acc);box-shadow:0 0 8px var(--acc-g);animation:pulse 1.1s ease-in-out infinite}
    .status-dot.done{background:var(--success);box-shadow:0 0 8px rgba(0,204,112,.4)}
    .status-dot.error{background:var(--danger);box-shadow:0 0 8px rgba(232,56,80,.4)}
    @keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(.75)}}

    .progress-wrap{display:none;margin-top:10px}
    .progress-wrap.active{display:block}
    .progress-header{
      display:flex;justify-content:space-between;margin-bottom:5px;
      font-family:var(--font-m);font-size:9px;color:var(--mute);letter-spacing:1px;
    }
    .progress-track{width:100%;height:2px;background:var(--bdr);position:relative;overflow:visible}
    .progress-fill{
      height:100%;background:var(--acc);transition:width .5s ease;width:0%;
      box-shadow:0 0 8px var(--acc-g);position:relative;
    }
    .progress-fill::after{
      content:'';position:absolute;right:-1px;top:-2px;
      width:4px;height:6px;background:var(--acc2);
      box-shadow:0 0 6px var(--acc);
    }

    /* ── MAIN PANEL (right) ── */
    .main-panel{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0}
    .stream-card{flex:1;display:flex;flex-direction:column;overflow:hidden;background:var(--bg)}

    .stream-header{
      padding:13px 20px;border-bottom:1px solid var(--bdr);
      display:flex;align-items:center;justify-content:space-between;flex-shrink:0;
      background:rgba(5,7,14,.85);backdrop-filter:blur(6px);
    }
    .stream-header-left{display:flex;align-items:center;gap:12px}
    .stream-header-left .icon{
      width:7px;height:7px;border-radius:50%;
      background:var(--success);box-shadow:0 0 8px rgba(0,204,112,.55);
    }
    .stream-title{font-family:var(--font-d);font-size:15px;letter-spacing:3.5px;color:var(--text)}
    .stream-sub{font-family:var(--font-m);font-size:8.5px;color:var(--mute);letter-spacing:1.5px;margin-top:1px}

    /* Agent Activity Panel */
    .agent-panel{
      display:none;padding:10px 20px;flex-shrink:0;
      background:var(--bg2);border-bottom:1px solid var(--bdr);
    }
    .agent-panel.active{display:flex;align-items:center;gap:12px;animation:fadein .2s ease}
    @keyframes fadein{from{opacity:0}to{opacity:1}}
    .agent-panel-avatar{
      width:32px;height:32px;border-radius:var(--r);
      display:flex;align-items:center;justify-content:center;
      font-family:var(--font-d);font-size:20px;flex-shrink:0;color:#000;
    }
    .agent-panel-info{flex:1}
    .agent-panel-name{font-family:var(--font-d);font-size:13px;letter-spacing:2.5px}
    .agent-panel-phase{
      font-family:var(--font-m);font-size:10px;color:var(--sub);
      display:flex;align-items:center;gap:6px;margin-top:1px;letter-spacing:.5px;
    }
    .spinner{
      width:9px;height:9px;border:1.5px solid var(--bdr2);border-top-color:var(--acc);
      border-radius:50%;animation:spin .7s linear infinite;flex-shrink:0;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* ── MESSAGES ── */
    .messages-area{flex:1;overflow-y:auto;overflow-x:hidden;scroll-behavior:smooth}
    .messages-area::-webkit-scrollbar{width:3px}
    .messages-area::-webkit-scrollbar-thumb{background:var(--bdr2)}

    .msg-empty{
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      padding:80px 40px;text-align:center;min-height:300px;
    }
    .msg-empty-icon{
      font-family:var(--font-d);font-size:40px;letter-spacing:12px;
      color:var(--mute);margin-bottom:18px;opacity:.6;
    }
    .msg-empty-text{
      font-family:var(--font-m);font-size:11px;color:var(--mute);
      line-height:2;letter-spacing:.5px;
    }
    .msg-empty-text strong{color:var(--sub)}

    /* ── ROUND DIVIDERS ── */
    .round-divider{display:flex;align-items:center;padding:13px 20px;gap:14px}
    .round-divider-line{flex:1;height:1px;background:var(--bdr)}
    .round-badge{
      display:inline-flex;align-items:center;gap:7px;
      padding:4px 13px;background:var(--surf);border:1px solid var(--bdr2);
      font-family:var(--font-d);font-size:12px;letter-spacing:3px;
      color:var(--sub);border-radius:var(--r);white-space:nowrap;
    }
    .round-badge-dot{width:5px;height:5px;border-radius:50%;background:var(--acc);box-shadow:0 0 5px var(--acc-g)}
    .round-badge.synthesis{border-color:var(--c-b);color:var(--c)}
    .round-badge.synthesis .round-badge-dot{background:var(--c);box-shadow:0 0 5px var(--c-g)}

    /* ── MESSAGE CARDS ── */
    @keyframes msgSlideIn{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:translateX(0)}}
    .msg{
      padding:16px 20px;border-left:2px solid transparent;
      position:relative;transition:background var(--t);
    }
    .msg:not(:last-child){border-bottom:1px solid var(--bdr)}
    .msg.A{border-left-color:var(--a);background:var(--a-d)}.msg.A:hover{background:rgba(72,136,244,.055)}
    .msg.B{border-left-color:var(--b);background:var(--b-d)}.msg.B:hover{background:rgba(240,68,104,.055)}
    .msg.C{border-left-color:var(--c);background:var(--c-d)}.msg.C:hover{background:rgba(0,216,122,.055)}
    .msg.user{border-left-color:var(--bdr3);background:var(--u-d)}

    .msg-header{display:flex;align-items:center;gap:10px;margin-bottom:10px}
    .msg-avatar{
      width:28px;height:28px;border-radius:var(--r);
      display:flex;align-items:center;justify-content:center;
      font-family:var(--font-d);font-size:17px;flex-shrink:0;
    }
    .msg.A .msg-avatar{background:rgba(72,136,244,.16);color:var(--a);border:1px solid var(--a-b)}
    .msg.B .msg-avatar{background:rgba(240,68,104,.16);color:var(--b);border:1px solid var(--b-b)}
    .msg.C .msg-avatar{background:rgba(0,216,122,.16);color:var(--c);border:1px solid var(--c-b)}
    .msg.user .msg-avatar{background:rgba(74,106,140,.16);color:var(--u);border:1px solid rgba(74,106,140,.28)}

    .msg-info{flex:1;min-width:0}
    .msg-role{font-family:var(--font-d);font-size:13px;letter-spacing:2.5px}
    .msg.A .msg-role{color:var(--a)}.msg.B .msg-role{color:var(--b)}.msg.C .msg-role{color:var(--c)}.msg.user .msg-role{color:var(--u)}
    .msg-subtitle{font-family:var(--font-m);font-size:9.5px;color:var(--mute);display:flex;gap:6px;margin-top:2px;letter-spacing:.4px}
    .msg-time{font-family:var(--font-m);font-size:10px;color:var(--mute);flex-shrink:0;letter-spacing:.5px}

    /* ── MARKDOWN ── */
    .markdown-body{font-size:13px;color:var(--text);line-height:1.8}
    .markdown-body h2{font-family:var(--font-d);font-size:18px;letter-spacing:2px;margin:14px 0 6px;color:var(--text)}
    .markdown-body h3{font-family:var(--font-d);font-size:15px;letter-spacing:1.5px;margin:10px 0 4px}
    .markdown-body h4,.markdown-body h5{font-size:12.5px;font-weight:600;margin:8px 0 3px;color:var(--sub)}
    .markdown-body p{margin:5px 0}
    .markdown-body ul,.markdown-body ol{margin:5px 0 5px 16px}
    .markdown-body li{margin:3px 0}
    .markdown-body code{
      background:var(--surf2);border:1px solid var(--bdr2);
      padding:1px 5px;border-radius:2px;font-family:var(--font-m);font-size:11px;color:var(--acc);
    }
    .markdown-body pre{
      background:var(--surf);border:1px solid var(--bdr2);
      padding:12px;border-radius:var(--r);overflow-x:auto;margin:8px 0;
    }
    .markdown-body pre code{background:none;border:none;padding:0;color:var(--text);font-size:12px}
    .markdown-body a{color:var(--a);text-decoration:none}.markdown-body a:hover{text-decoration:underline}
    .markdown-body blockquote{border-left:2px solid var(--acc);padding-left:12px;color:var(--sub);margin:6px 0}

    /* ── META SECTIONS ── */
    .meta-sections{margin-top:14px;display:flex;flex-direction:column;gap:10px}
    .meta-header{
      display:flex;align-items:center;gap:5px;margin-bottom:6px;
      font-family:var(--font-m);font-size:8.5px;letter-spacing:2px;
      text-transform:uppercase;color:var(--mute);
    }
    .meta-header svg{width:11px;height:11px;flex-shrink:0;stroke:var(--mute);fill:none;stroke-width:1.5}
    .meta-count{
      background:var(--surf);border:1px solid var(--bdr);
      padding:0 5px;border-radius:2px;font-size:8.5px;color:var(--sub);
    }

    /* Search pills */
    .search-directives{display:flex;flex-wrap:wrap;gap:5px}
    .search-pill{
      display:inline-flex;align-items:center;gap:5px;
      padding:4px 9px;background:var(--surf);border:1px solid var(--bdr2);border-radius:var(--r);
      font-family:var(--font-m);font-size:10px;color:var(--sub);transition:var(--t);max-width:100%;
    }
    .search-pill:hover{border-color:var(--bdr3);color:var(--text)}
    .search-pill-icon{
      width:13px;height:13px;border-radius:50%;background:var(--surf2);
      border:1px solid var(--bdr2);display:flex;align-items:center;justify-content:center;flex-shrink:0;
    }
    .search-pill-icon svg{width:7px;height:7px;stroke:var(--sub);fill:none;stroke-width:1.5}
    .search-pill-text{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .search-pill-domain{
      display:inline-flex;padding:0 4px;
      background:var(--acc-d);border:1px solid rgba(217,154,24,.2);
      border-radius:2px;font-size:8.5px;color:var(--acc);flex-shrink:0;
    }

    /* Retrieval cards */
    .retrieval-grid{display:flex;flex-direction:column;gap:5px}
    .retrieval-card{
      display:flex;gap:10px;padding:9px 11px;
      background:var(--surf);border:1px solid var(--bdr);border-radius:var(--r);transition:var(--t);
    }
    .retrieval-card:hover{border-color:var(--bdr2);background:var(--surf2)}
    .retrieval-idx{
      width:22px;height:22px;border-radius:2px;
      background:var(--surf2);border:1px solid var(--bdr2);
      color:var(--acc);display:flex;align-items:center;justify-content:center;
      font-family:var(--font-m);font-size:9px;flex-shrink:0;margin-top:1px;
    }
    .retrieval-body{flex:1;min-width:0}
    .retrieval-title{font-size:12px;font-weight:500;color:var(--text);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .retrieval-title a{color:var(--a);text-decoration:none}.retrieval-title a:hover{text-decoration:underline}
    .retrieval-url{font-family:var(--font-m);font-size:10px;color:var(--mute);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-top:2px}
    .retrieval-snippet{font-size:11.5px;color:var(--sub);line-height:1.5;margin-top:3px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .retrieval-score{
      flex-shrink:0;align-self:flex-start;padding:1px 5px;
      background:rgba(0,200,112,.07);border:1px solid rgba(0,200,112,.2);
      border-radius:2px;font-family:var(--font-m);font-size:9px;color:var(--success);
    }

    /* Structured JSON */
    details{margin-top:10px}
    details summary{
      font-family:var(--font-m);font-size:9px;letter-spacing:1.5px;text-transform:uppercase;
      color:var(--sub);cursor:pointer;padding:4px 10px;background:var(--surf);
      border:1px solid var(--bdr);border-radius:var(--r);display:inline-flex;
      align-items:center;gap:5px;transition:var(--t);user-select:none;
    }
    details summary:hover{border-color:var(--bdr2);color:var(--text)}
    details[open] summary{margin-bottom:6px}
    details pre{
      background:var(--surf);border:1px solid var(--bdr);border-radius:var(--r);
      padding:12px;font-family:var(--font-m);font-size:11px;line-height:1.5;
      overflow-x:auto;max-height:300px;overflow-y:auto;color:var(--sub);
    }

    /* ── STREAMING CARD ── */
    .msg-streaming{animation:msgSlideIn .3s ease}
    .stream-text{
      white-space:pre-wrap;word-break:break-word;
      font-size:13px;color:var(--text);line-height:1.8;
    }
    .stream-cursor{
      display:inline-block;width:2px;height:1em;
      background:var(--acc);margin-left:1px;vertical-align:text-bottom;
      border-radius:1px;box-shadow:0 0 7px var(--acc-g);
      animation:blink .9s step-end infinite;
    }
    @keyframes blink{0%,100%{opacity:1}50%{opacity:0}}
    .stream-badge{
      display:inline-flex;align-items:center;gap:5px;
      font-family:var(--font-m);font-size:9.5px;color:var(--acc);letter-spacing:1.5px;
    }
    .stream-badge::before{
      content:'';display:inline-block;width:5px;height:5px;border-radius:50%;
      background:var(--acc);box-shadow:0 0 6px var(--acc-g);
      animation:pulse .9s ease-in-out infinite;
    }

    /* ── SETTINGS PAGE ── */
    .settings-page-hdr{
      font-family:var(--font-d);font-size:22px;letter-spacing:5px;color:var(--sub);
      margin-bottom:20px;padding-bottom:14px;border-bottom:1px solid var(--bdr);
    }
    .settings-page-hdr span{color:var(--acc)}
    .settings-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:12px;max-width:1380px}
    .settings-card{
      background:var(--surf);border:1px solid var(--bdr);border-radius:var(--r);padding:18px;transition:var(--t);
    }
    .settings-card:hover{border-color:var(--bdr2);box-shadow:0 0 20px rgba(0,0,0,.25)}
    .settings-card-header{
      display:flex;align-items:center;gap:12px;margin-bottom:16px;
      padding-bottom:12px;border-bottom:1px solid var(--bdr);
    }
    .settings-badge{
      width:32px;height:32px;border-radius:var(--r);
      display:flex;align-items:center;justify-content:center;font-family:var(--font-d);font-size:20px;
    }
    .settings-card-title{font-family:var(--font-d);font-size:14px;letter-spacing:2.5px}
    .settings-card-desc{font-family:var(--font-m);font-size:9.5px;color:var(--sub);margin-top:2px;letter-spacing:.3px}
    /* agent-specific */
    .settings-card.agent-a{border-left:2px solid var(--a)}
    .settings-card.agent-a .settings-badge{background:rgba(72,136,244,.14);color:var(--a);border:1px solid var(--a-b)}
    .settings-card.agent-a .settings-card-title{color:var(--a)}
    .settings-card.agent-b{border-left:2px solid var(--b)}
    .settings-card.agent-b .settings-badge{background:rgba(240,68,104,.14);color:var(--b);border:1px solid var(--b-b)}
    .settings-card.agent-b .settings-card-title{color:var(--b)}
    .settings-card.agent-c{border-left:2px solid var(--c)}
    .settings-card.agent-c .settings-badge{background:rgba(0,216,122,.14);color:var(--c);border:1px solid var(--c-b)}
    .settings-card.agent-c .settings-card-title{color:var(--c)}
    .settings-card.tavily{border-left:2px solid var(--acc)}
    .settings-card.tavily .settings-badge{background:var(--acc-d);color:var(--acc);border:1px solid rgba(217,154,24,.28)}
    .settings-card.tavily .settings-card-title{color:var(--acc)}

    /* Legacy classes (.card for any stray usage) */
    .card{background:var(--surf);border:1px solid var(--bdr);border-radius:var(--r);padding:16px;margin-bottom:10px}
    .card-title{font-family:var(--font-d);font-size:14px;letter-spacing:2px;color:var(--sub);margin-bottom:12px;display:flex;align-items:center;gap:8px}
    .card-title .icon{width:20px;height:20px;border-radius:2px;display:inline-flex;align-items:center;justify-content:center;font-size:11px}

    /* ── RESPONSIVE ── */
    @media(max-width:820px){
      :root{--side:100%}
      #chatPage.active{flex-direction:column;height:auto;overflow:visible}
      .sidebar{width:100%;border-right:none;border-bottom:1px solid var(--bdr);max-height:55vh}
      .main-panel{min-height:50vh}
      .messages-area{max-height:50vh}
      .header{padding:0 12px}
      .hdr-rule,.hdr-stats{display:none}
      #settingsPage.active{padding:14px}
      .settings-grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>

<!-- ══════ HEADER ══════ -->
<header class="header">
  <div class="logo">
    <div class="logo-mark">PR</div>
    <div class="logo-wordmark">
      <div class="logo-name">PR<em>/</em>CIRCLE</div>
      <div class="logo-tagline">Multi-Agent Intelligence Platform</div>
    </div>
  </div>
  <div class="hdr-rule"></div>
  <div class="hdr-stats">
    <span><span class="hdr-stat-dot live"></span>SYSTEM ONLINE</span>
    <span><span class="hdr-stat-dot" style="background:var(--a);box-shadow:0 0 5px var(--a-g)"></span>ANALYST</span>
    <span><span class="hdr-stat-dot" style="background:var(--b);box-shadow:0 0 5px var(--b-g)"></span>CHALLENGER</span>
    <span><span class="hdr-stat-dot" style="background:var(--c);box-shadow:0 0 5px var(--c-g)"></span>OBSERVER</span>
  </div>
  <nav class="nav-tabs">
    <div class="nav-tab active" data-target="chatPage">Analysis</div>
    <div class="nav-tab" data-target="settingsPage">Config</div>
  </nav>
</header>

<div class="shell">

  <!-- ══════ CHAT PAGE ══════ -->
  <div id="chatPage" class="page active">

    <!-- ── Sidebar ── -->
    <aside class="sidebar">

      <!-- Session -->
      <div class="s-sect">
        <div class="s-label">Session</div>
        <div class="session-bar">
          <select id="sessionSelect" class="session-select"></select>
          <button id="newSessionBtn" class="btn btn-outline btn-sm" type="button">+ New</button>
          <button id="clearSessionBtn" class="btn btn-danger btn-sm" type="button">Clear</button>
        </div>
      </div>

      <!-- Mission Parameters -->
      <div class="s-sect">
        <div class="s-label">Mission Parameters</div>
        <div class="form-group">
          <label class="form-label" for="topic">Event Topic</label>
          <textarea id="topic" rows="2" placeholder="Enter the political event topic…" style="min-height:50px"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label" for="timeContext">Time Context</label>
          <input id="timeContext" placeholder="e.g. 72 hours after initial report…" />
        </div>
        <div class="form-group">
          <label class="form-label" for="prGoal">PR Objective</label>
          <input id="prGoal" placeholder="e.g. stabilize sentiment, rebuild trust…" />
        </div>
        <div class="form-row" style="align-items:flex-end">
          <div class="form-field" style="flex:0 0 74px">
            <label class="form-label" for="maxRounds">Rounds</label>
            <input id="maxRounds" type="number" value="3" min="1" max="8" />
          </div>
          <div class="form-field">
            <button id="startBtn" class="btn btn-start" type="button">EXECUTE</button>
          </div>
        </div>
        <button id="stopBtn" class="btn btn-outline btn-sm" type="button" style="display:none;width:100%;margin-top:6px;color:var(--danger);border-color:rgba(232,56,80,.22)">&#11035; ABORT MISSION</button>
        <div class="status-bar">
          <span id="statusDot" class="status-dot"></span>
          <span id="runStatus">Ready</span>
        </div>
        <div id="progressWrap" class="progress-wrap">
          <div class="progress-header">
            <span id="progressLabel">ROUND 0 / 0</span>
            <span id="progressPct">0%</span>
          </div>
          <div class="progress-track">
            <div id="progressFill" class="progress-fill"></div>
          </div>
        </div>
      </div>

      <!-- Agents -->
      <div class="s-sect" style="flex:1">
        <div class="s-label">Active Agents</div>
        <div class="agent-widget aw-a">
          <div class="aw-letter">A</div>
          <div>
            <div class="aw-name">Analyst</div>
            <div class="aw-desc">Strategy with evidence</div>
          </div>
        </div>
        <div class="agent-widget aw-b">
          <div class="aw-letter">B</div>
          <div>
            <div class="aw-name">Challenger</div>
            <div class="aw-desc">Critiques with counter-evidence</div>
          </div>
        </div>
        <div class="agent-widget aw-c">
          <div class="aw-letter">C</div>
          <div>
            <div class="aw-name">Observer</div>
            <div class="aw-desc">Synthesizes final strategy</div>
          </div>
        </div>
      </div>

    </aside>

    <!-- ── Main Panel ── -->
    <main class="main-panel">
      <div class="stream-card">

        <div class="stream-header">
          <div class="stream-header-left">
            <span class="icon"></span>
            <div>
              <div class="stream-title">DIALOGUE STREAM</div>
              <div class="stream-sub">Real-time multi-agent debate</div>
            </div>
          </div>
          <span id="msgCount" style="font-family:var(--font-m);font-size:10px;color:var(--mute);letter-spacing:1px"></span>
        </div>

        <!-- Active Agent Panel -->
        <div id="agentPanel" class="agent-panel">
          <div id="agentPanelAvatar" class="agent-panel-avatar">A</div>
          <div class="agent-panel-info">
            <div id="agentPanelName" class="agent-panel-name">AGENT A</div>
            <div class="agent-panel-phase">
              <div class="spinner" id="agentSpinner"></div>
              <span id="agentPanelPhase">Searching &amp; retrieving…</span>
            </div>
          </div>
        </div>

        <!-- Messages -->
        <div id="messages" class="messages-area">
          <div class="msg-empty" id="emptyState">
            <div class="msg-empty-icon">&#9672;&#9672;&#9672;</div>
            <div class="msg-empty-text">
              No transmissions received.<br/>
              Configure mission parameters and click<br/>
              <strong>EXECUTE</strong> to begin intelligence analysis.
            </div>
          </div>
        </div>

      </div>
    </main>

  </div><!-- /chatPage -->

  <!-- ══════ SETTINGS PAGE ══════ -->
  <div id="settingsPage" class="page">
    <div class="settings-page-hdr">SYSTEM <span>CONFIG</span></div>
    <div class="settings-grid">

      <div class="settings-card agent-a">
        <div class="settings-card-header">
          <div class="settings-badge">A</div>
          <div>
            <div class="settings-card-title">Agent A — Analyst</div>
            <div class="settings-card-desc">Proposes structured strategies with evidence</div>
          </div>
        </div>
        <div class="form-group"><label class="form-label">Model</label><input id="a_model" value="gemini-3-flash-preview-nothinking" /></div>
        <div class="form-group"><label class="form-label">API Endpoint</label><input id="a_base" value="https://api.apiyi.com/v1" /></div>
        <div class="form-group"><label class="form-label">API Key</label><input id="a_key" type="password" placeholder="sk-…" /></div>
        <div class="form-row">
          <div class="form-field"><label class="form-label">Temperature</label><input id="a_temp" value="0.7" type="number" step="0.1" min="0" max="2" /></div>
          <div class="form-field"><label class="form-label">Max Tokens</label><input id="a_max" value="800" type="number" /></div>
        </div>
        <div class="form-group"><label class="form-label">Capability Prompt</label><textarea id="a_capability"></textarea></div>
      </div>

      <div class="settings-card agent-b">
        <div class="settings-card-header">
          <div class="settings-badge">B</div>
          <div>
            <div class="settings-card-title">Agent B — Challenger</div>
            <div class="settings-card-desc">Critiques proposals with counter-evidence</div>
          </div>
        </div>
        <div class="form-group"><label class="form-label">Model</label><input id="b_model" value="gemini-3-flash-preview-nothinking" /></div>
        <div class="form-group"><label class="form-label">API Endpoint</label><input id="b_base" value="https://api.apiyi.com/v1" /></div>
        <div class="form-group"><label class="form-label">API Key</label><input id="b_key" type="password" placeholder="sk-…" /></div>
        <div class="form-row">
          <div class="form-field"><label class="form-label">Temperature</label><input id="b_temp" value="0.7" type="number" step="0.1" min="0" max="2" /></div>
          <div class="form-field"><label class="form-label">Max Tokens</label><input id="b_max" value="800" type="number" /></div>
        </div>
        <div class="form-group"><label class="form-label">Capability Prompt</label><textarea id="b_capability"></textarea></div>
      </div>

      <div class="settings-card agent-c">
        <div class="settings-card-header">
          <div class="settings-badge">C</div>
          <div>
            <div class="settings-card-title">Agent C — Observer</div>
            <div class="settings-card-desc">Synthesizes the final strategy report</div>
          </div>
        </div>
        <div class="form-group"><label class="form-label">Model</label><input id="c_model" value="gemini-3-flash-preview-nothinking" /></div>
        <div class="form-group"><label class="form-label">API Endpoint</label><input id="c_base" value="https://api.apiyi.com/v1" /></div>
        <div class="form-group"><label class="form-label">API Key</label><input id="c_key" type="password" placeholder="sk-…" /></div>
        <div class="form-row">
          <div class="form-field"><label class="form-label">Temperature</label><input id="c_temp" value="0.7" type="number" step="0.1" min="0" max="2" /></div>
          <div class="form-field"><label class="form-label">Max Tokens</label><input id="c_max" value="1000" type="number" /></div>
        </div>
        <div class="form-group"><label class="form-label">Capability Prompt</label><textarea id="c_capability">偏向形成可执行的最终策略报告，明确优先级、风险预案和监测指标。</textarea></div>
      </div>

      <div class="settings-card tavily">
        <div class="settings-card-header">
          <div class="settings-badge">T</div>
          <div>
            <div class="settings-card-title">Tavily Search</div>
            <div class="settings-card-desc">External intelligence retrieval</div>
          </div>
        </div>
        <div class="form-group"><label class="form-label">API Key</label><input id="tavilyKey" type="password" placeholder="tvly-…" /></div>
        <div class="form-group"><label class="form-label">Search Top-K</label><input id="searchTopk" type="number" value="3" min="1" max="20" /></div>
        <div class="form-group"><label class="form-label">Domain Filters</label><input id="searchDomains" placeholder="reddit.com, ptt.cc, …" /></div>
      </div>

    </div>
  </div><!-- /settingsPage -->

</div><!-- /shell -->

<script src="/static/main.js"></script>
</body>
</html>
